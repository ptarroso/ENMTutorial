<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Chapter 1 - The presence data housekeeping | Ecological Niche Modelling</title>
  <meta name="description" content="2 Chapter 1 - The presence data housekeeping | Ecological Niche Modelling" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Chapter 1 - The presence data housekeeping | Ecological Niche Modelling" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Chapter 1 - The presence data housekeeping | Ecological Niche Modelling" />
  
  
  

<meta name="author" content="Pedro Tarroso (FCUP / BIOPOLIS-CIBIO)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="course-folder-structure-and-data.html"/>
<link rel="next" href="chapter-2---processing-the-raster-data.html"/>
<script src="assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble</a></li>
<li class="chapter" data-level="1" data-path="course-folder-structure-and-data.html"><a href="course-folder-structure-and-data.html"><i class="fa fa-check"></i><b>1</b> Course folder structure and data</a></li>
<li class="chapter" data-level="2" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html"><i class="fa fa-check"></i><b>2</b> Chapter 1 - The presence data housekeeping</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html#remove-rows-with-missing-coordinates"><i class="fa fa-check"></i><b>2.1</b> Remove rows with missing coordinates</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html#remove-rows-that-fail-cleaning-tests"><i class="fa fa-check"></i><b>2.2</b> Remove rows that fail cleaning tests</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html#remove-rows-based-on-additional-gbif-information"><i class="fa fa-check"></i><b>2.3</b> Remove rows based on additional GBIF information</a></li>
<li class="chapter" data-level="2.4" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html#remove-duplicated-coordinates"><i class="fa fa-check"></i><b>2.4</b> Remove duplicated coordinates</a></li>
<li class="chapter" data-level="2.5" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html#check-map"><i class="fa fa-check"></i><b>2.5</b> Check map</a></li>
<li class="chapter" data-level="2.6" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html#save-the-new-data"><i class="fa fa-check"></i><b>2.6</b> Save the new data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-2---processing-the-raster-data.html"><a href="chapter-2---processing-the-raster-data.html"><i class="fa fa-check"></i><b>3</b> Chapter 2 - Processing the raster data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter-2---processing-the-raster-data.html"><a href="chapter-2---processing-the-raster-data.html#general-layers"><i class="fa fa-check"></i><b>3.1</b> General layers</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-2---processing-the-raster-data.html"><a href="chapter-2---processing-the-raster-data.html#processing-climate-layers"><i class="fa fa-check"></i><b>3.2</b> Processing climate layers</a></li>
<li class="chapter" data-level="3.3" data-path="chapter-2---processing-the-raster-data.html"><a href="chapter-2---processing-the-raster-data.html#process-evi"><i class="fa fa-check"></i><b>3.3</b> Process EVI</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-3---final-optimization-of-presence-data.html"><a href="chapter-3---final-optimization-of-presence-data.html"><i class="fa fa-check"></i><b>4</b> Chapter 3 - Final optimization of presence data</a></li>
<li class="chapter" data-level="5" data-path="chapter-4---variable-selection-for-modelling.html"><a href="chapter-4---variable-selection-for-modelling.html"><i class="fa fa-check"></i><b>5</b> Chapter 4 - Variable selection for modelling</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chapter-4---variable-selection-for-modelling.html"><a href="chapter-4---variable-selection-for-modelling.html#define-a-training-area-with-a-buffer"><i class="fa fa-check"></i><b>5.1</b> Define a training area with a buffer</a></li>
<li class="chapter" data-level="5.2" data-path="chapter-4---variable-selection-for-modelling.html"><a href="chapter-4---variable-selection-for-modelling.html#calculate-pairwise-correlations"><i class="fa fa-check"></i><b>5.2</b> Calculate pairwise correlations</a></li>
<li class="chapter" data-level="5.3" data-path="chapter-4---variable-selection-for-modelling.html"><a href="chapter-4---variable-selection-for-modelling.html#clustering-and-selection"><i class="fa fa-check"></i><b>5.3</b> Clustering and selection</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-5---prepare-projection-variables.html"><a href="chapter-5---prepare-projection-variables.html"><i class="fa fa-check"></i><b>6</b> Chapter 5 - Prepare projection variables</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter-5---prepare-projection-variables.html"><a href="chapter-5---prepare-projection-variables.html#prepare-current-dataset-for-projection"><i class="fa fa-check"></i><b>6.1</b> Prepare current dataset for projection</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-5---prepare-projection-variables.html"><a href="chapter-5---prepare-projection-variables.html#prepare-future-climate-projections"><i class="fa fa-check"></i><b>6.2</b> Prepare future climate projections</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-6---model-building.html"><a href="chapter-6---model-building.html"><i class="fa fa-check"></i><b>7</b> Chapter 6 - Model building</a>
<ul>
<li class="chapter" data-level="7.1" data-path="chapter-6---model-building.html"><a href="chapter-6---model-building.html#model-building"><i class="fa fa-check"></i><b>7.1</b> Model building</a></li>
<li class="chapter" data-level="7.2" data-path="chapter-6---model-building.html"><a href="chapter-6---model-building.html#repeat-for-the-other-two-species"><i class="fa fa-check"></i><b>7.2</b> Repeat for the other two species</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="chapter-6---model-building.html"><a href="chapter-6---model-building.html#vipera-latastei"><i class="fa fa-check"></i><b>7.2.1</b> <em>Vipera latastei</em></a></li>
<li class="chapter" data-level="7.2.2" data-path="chapter-6---model-building.html"><a href="chapter-6---model-building.html#vipera-seoanei"><i class="fa fa-check"></i><b>7.2.2</b> <em>Vipera seoanei</em></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chapter-6---model-building.html"><a href="chapter-6---model-building.html#final-considerations-for-the-modelling"><i class="fa fa-check"></i><b>7.3</b> Final considerations for the modelling</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-7---model-ensemble.html"><a href="chapter-7---model-ensemble.html"><i class="fa fa-check"></i><b>8</b> Chapter 7 - Model ensemble</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chapter-7---model-ensemble.html"><a href="chapter-7---model-ensemble.html#ensembling-vipera-aspis"><i class="fa fa-check"></i><b>8.1</b> Ensembling <em>Vipera aspis</em></a></li>
<li class="chapter" data-level="8.2" data-path="chapter-7---model-ensemble.html"><a href="chapter-7---model-ensemble.html#ensembling-vipera-latastei"><i class="fa fa-check"></i><b>8.2</b> Ensembling <em>Vipera latastei</em></a></li>
<li class="chapter" data-level="8.3" data-path="chapter-7---model-ensemble.html"><a href="chapter-7---model-ensemble.html#ensembling-vipera-seoanei"><i class="fa fa-check"></i><b>8.3</b> Ensembling <em>Vipera seoanei</em></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="final-considerations-for-the-ensembling.html"><a href="final-considerations-for-the-ensembling.html"><i class="fa fa-check"></i><b>9</b> Final considerations for the ensembling</a></li>
<li class="chapter" data-level="10" data-path="chapter-8---model-projections.html"><a href="chapter-8---model-projections.html"><i class="fa fa-check"></i><b>10</b> Chapter 8 - Model projections</a>
<ul>
<li class="chapter" data-level="10.1" data-path="chapter-8---model-projections.html"><a href="chapter-8---model-projections.html#projecting-vipera-aspis-models"><i class="fa fa-check"></i><b>10.1</b> Projecting <em>Vipera aspis</em> models</a></li>
<li class="chapter" data-level="10.2" data-path="chapter-8---model-projections.html"><a href="chapter-8---model-projections.html#projecting-vipera-latastei-models"><i class="fa fa-check"></i><b>10.2</b> Projecting <em>Vipera latastei</em> models</a></li>
<li class="chapter" data-level="10.3" data-path="chapter-8---model-projections.html"><a href="chapter-8---model-projections.html#projecting-vipera-latastei-models-1"><i class="fa fa-check"></i><b>10.3</b> Projecting <em>Vipera latastei</em> models</a></li>
<li class="chapter" data-level="10.4" data-path="chapter-8---model-projections.html"><a href="chapter-8---model-projections.html#final-considerations-for-projections"><i class="fa fa-check"></i><b>10.4</b> Final considerations for projections</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="chapter-9---finally-answering-the-question.html"><a href="chapter-9---finally-answering-the-question.html"><i class="fa fa-check"></i><b>11</b> Chapter 9 - Finally, answering the question</a></li>
<li class="chapter" data-level="12" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>12</b> Conclusion</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Ecological Niche Modelling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-1---the-presence-data-housekeeping" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Chapter 1 - The presence data housekeeping<a href="chapter-1---the-presence-data-housekeeping.html#chapter-1---the-presence-data-housekeeping" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter, we will open and clean the presence data for each of the three species. Cleaning the data involves removing erroneous entries such as those with missing coordinates, incorrect coordinates (e.g., outside the species’ known range), imprecise locations (high uncertainty), and other issues. The quality filters applied to the presence data will be based on both geographical information and attribute information provided by GBIF for each presence point.</p>
<p>We need a special package called CoordinateCleaner that provides functions for cleaning presence data. If you don’t have it installed, you can install it either through the RStudio menu or by running the command:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb4-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;CoordinateCleaner&quot;</span>)</span></code></pre></div>
<div class="noteblock">
<p><strong>NOTE</strong>: Besides here, only in Chapter 6 will you be asked to install some packages in this document. However, be aware that if a package is not installed, R will generate an error indicating that the package cannot be found or is not available. In such cases, install the necessary package using the instruction provided above (changing the name of the package to the one you need!).</p>
</div>
<p>Packages only need to be installed once. However, to use the functionality of an installed package in an R session, you must load it with the <code>library()</code> command. This command needs to be executed in every new R session where you want to use the additional package.</p>
<p>open the package</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb5-1" tabindex="-1"></a><span class="fu">library</span>(CoordinateCleaner)</span></code></pre></div>
<p>We need to open the raw GBIF downloaded data into R. Since we downloaded it in the simple text CSV format, we can use native R functions to open it. If you check the data with a simple text editor, you would see that it has a header (the first line has column names), and each column is separated by a TAB. We specify these settings in the arguments of the <code>read.table()</code> function to correctly read the data. Additionally, we set two other arguments: <code>quote=""</code> and <code>comment.char=""</code>. These settings prevent the possible use of characters such as double quotes (“) or hash symbols (#) in the data, which could potentially break the reading process.”.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb6-1" tabindex="-1"></a>vasp <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/species/original/Vaspis.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">quote=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb6-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb6-2" tabindex="-1"></a>vlat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/species/original/Vlatastei.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">quote=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb6-3"><a href="chapter-1---the-presence-data-housekeeping.html#cb6-3" tabindex="-1"></a>vseo <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/species/original/Vseoanei.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">quote=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>We can keep track of the dimensions of each dataset to check how many points we remove in the process.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb7-1" tabindex="-1"></a><span class="fu">dim</span>(vasp)</span></code></pre></div>
<pre><code>## [1] 35929    50</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb9-1" tabindex="-1"></a><span class="fu">dim</span>(vlat)</span></code></pre></div>
<pre><code>## [1] 4477   50</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb11-1" tabindex="-1"></a><span class="fu">dim</span>(vseo)</span></code></pre></div>
<pre><code>## [1] 2070   50</code></pre>
<div id="remove-rows-with-missing-coordinates" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Remove rows with missing coordinates<a href="chapter-1---the-presence-data-housekeeping.html#remove-rows-with-missing-coordinates" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The column names that GBIF uses for coordinates are named <em>decimalLongitude</em> and <em>decimalLatitude</em>. We need to check these columns, as some of the presence data may be provided without locations.</p>
<p>To retrieve the rows with missing coordinate data (NA), we can create a mask that detects NAs. The function <em>is.na</em> returns TRUE if the value in the row is NA, and FALSE if it contains data. Mathematical operations involving numbers and NAs typically result in NA. We leverage this functionality to check whether any of the longitude or latitude (or both) columns contain NAs.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb13-1" tabindex="-1"></a>mask_vasp <span class="ot">&lt;-</span> <span class="fu">is.na</span>(vasp<span class="sc">$</span>decimalLatitude <span class="sc">+</span> vasp<span class="sc">$</span>decimalLongitude)</span>
<span id="cb13-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb13-2" tabindex="-1"></a>vasp <span class="ot">&lt;-</span> vasp[<span class="sc">!</span>mask_vasp,]</span></code></pre></div>
<p>The exclamtion point (!) inverts the logical values: TRUE become FALSE, and FALSE become TRUE. This is useful because TRUEs are the rows preserved and we want to preserved the non-NA in the filtering with [ ].</p>
<p>We repeat for the other species:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb14-1" tabindex="-1"></a>mask_vlat <span class="ot">&lt;-</span> <span class="fu">is.na</span>(vlat<span class="sc">$</span>decimalLatitude <span class="sc">+</span> vlat<span class="sc">$</span>decimalLongitude)</span>
<span id="cb14-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb14-2" tabindex="-1"></a>vlat <span class="ot">&lt;-</span> vlat[<span class="sc">!</span>mask_vlat,]</span>
<span id="cb14-3"><a href="chapter-1---the-presence-data-housekeeping.html#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="chapter-1---the-presence-data-housekeeping.html#cb14-4" tabindex="-1"></a>mask_vseo <span class="ot">&lt;-</span> <span class="fu">is.na</span>(vseo<span class="sc">$</span>decimalLatitude <span class="sc">+</span> vseo<span class="sc">$</span>decimalLongitude)</span>
<span id="cb14-5"><a href="chapter-1---the-presence-data-housekeeping.html#cb14-5" tabindex="-1"></a>vseo <span class="ot">&lt;-</span> vseo[<span class="sc">!</span>mask_vseo,]</span></code></pre></div>
<p>Just the dimensions again to track how many points we still have after this first filter:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb15-1" tabindex="-1"></a><span class="fu">dim</span>(vasp)</span></code></pre></div>
<pre><code>## [1] 33813    50</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb17-1" tabindex="-1"></a><span class="fu">dim</span>(vlat)</span></code></pre></div>
<pre><code>## [1] 4152   50</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb19-1" tabindex="-1"></a><span class="fu">dim</span>(vseo)</span></code></pre></div>
<pre><code>## [1] 1862   50</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb21-1" tabindex="-1"></a><span class="co"># Course folder structure and da</span></span></code></pre></div>
</div>
<div id="remove-rows-that-fail-cleaning-tests" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Remove rows that fail cleaning tests<a href="chapter-1---the-presence-data-housekeeping.html#remove-rows-that-fail-cleaning-tests" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>CoordinateCleaner package offer some data filtering. It provide a series of tests that we might select to flag with rows pass and do not pass the test. The tests we are going to use are:
* capitals: if coordinates are in the country capital coordinate, it usually indicates lack of precision
* centroids: if the coordinate is exactly at the centroid of a country, than it also indicate lack of precision
* equal: if longitude and latitude are equal is often an error
* gbif: this tests if the coordinate refers to the GBIF headquarters.
* instituions: some coordinates might be attributes to the institution providing rather than to the observation location. We remove those.
* zeros: if the coordinates are set to zero, (intersection of equation with prime meridian) are often wrong.</p>
<p>We set the test in a separate object an then run the cleaning function that will flag each row.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb22-1" tabindex="-1"></a>tests <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;capitals&quot;</span>, <span class="st">&quot;centroids&quot;</span>, <span class="st">&quot;equal&quot;</span>, <span class="st">&quot;gbif&quot;</span>, <span class="st">&quot;institutions&quot;</span>, <span class="st">&quot;zeros&quot;</span>)</span>
<span id="cb22-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb22-2" tabindex="-1"></a></span>
<span id="cb22-3"><a href="chapter-1---the-presence-data-housekeeping.html#cb22-3" tabindex="-1"></a>flags_vasp <span class="ot">&lt;-</span> <span class="fu">clean_coordinates</span>(<span class="at">x =</span> vasp, <span class="at">lon =</span> <span class="st">&quot;decimalLongitude&quot;</span>, <span class="at">lat =</span> <span class="st">&quot;decimalLatitude&quot;</span>,</span>
<span id="cb22-4"><a href="chapter-1---the-presence-data-housekeeping.html#cb22-4" tabindex="-1"></a>                                <span class="at">species =</span> <span class="st">&quot;species&quot;</span>, <span class="at">countries =</span> <span class="st">&quot;countryCode&quot;</span>,</span>
<span id="cb22-5"><a href="chapter-1---the-presence-data-housekeeping.html#cb22-5" tabindex="-1"></a>                                <span class="at">country_refcol =</span> <span class="st">&quot;iso_a2&quot;</span>, <span class="at">tests =</span> tests)</span></code></pre></div>
<pre><code>## Testing coordinate validity</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Testing equal lat/lon</code></pre>
<pre><code>## Flagged 1 records.</code></pre>
<pre><code>## Testing zero coordinates</code></pre>
<pre><code>## Flagged 1 records.</code></pre>
<pre><code>## Testing country capitals</code></pre>
<pre><code>## Flagged 65 records.</code></pre>
<pre><code>## Testing country centroids</code></pre>
<pre><code>## Flagged 121 records.</code></pre>
<pre><code>## Testing GBIF headquarters, flagging records around Copenhagen</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Testing biodiversity institutions</code></pre>
<pre><code>## Flagged 11 records.</code></pre>
<pre><code>## Flagged 192 of 33813 records, EQ = 0.01.</code></pre>
<p>If you check the last 8 columns of object “flags_vasp” you see a TRUE/FALSE columns for each test plus a <em>summary</em> that has a TRUE if the presence passed all tests. We want to keep those recods only.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb38-1" tabindex="-1"></a>vasp <span class="ot">&lt;-</span> vasp[flags_vasp<span class="sc">$</span>.summary,]</span></code></pre></div>
<p>Repeat for the other two species:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb39-1" tabindex="-1"></a>flags_vlat <span class="ot">&lt;-</span> <span class="fu">clean_coordinates</span>(<span class="at">x =</span> vlat, <span class="at">lon =</span> <span class="st">&quot;decimalLongitude&quot;</span>, <span class="at">lat =</span> <span class="st">&quot;decimalLatitude&quot;</span>,</span>
<span id="cb39-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb39-2" tabindex="-1"></a>                                <span class="at">species =</span> <span class="st">&quot;species&quot;</span>, <span class="at">countries =</span> <span class="st">&quot;countryCode&quot;</span>,</span>
<span id="cb39-3"><a href="chapter-1---the-presence-data-housekeeping.html#cb39-3" tabindex="-1"></a>                                <span class="at">country_refcol =</span> <span class="st">&quot;iso_a2&quot;</span>, <span class="at">tests =</span> tests)</span></code></pre></div>
<pre><code>## Testing coordinate validity</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Testing equal lat/lon</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Testing zero coordinates</code></pre>
<pre><code>## Flagged 5 records.</code></pre>
<pre><code>## Testing country capitals</code></pre>
<pre><code>## Flagged 4 records.</code></pre>
<pre><code>## Testing country centroids</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Testing GBIF headquarters, flagging records around Copenhagen</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Testing biodiversity institutions</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Flagged 9 of 4152 records, EQ = 0.</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb55-1" tabindex="-1"></a>vlat <span class="ot">&lt;-</span> vlat[flags_vlat<span class="sc">$</span>.summary,]</span>
<span id="cb55-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb55-2" tabindex="-1"></a></span>
<span id="cb55-3"><a href="chapter-1---the-presence-data-housekeeping.html#cb55-3" tabindex="-1"></a>flags_vseo <span class="ot">&lt;-</span> <span class="fu">clean_coordinates</span>(<span class="at">x =</span> vseo, <span class="at">lon =</span> <span class="st">&quot;decimalLongitude&quot;</span>, <span class="at">lat =</span> <span class="st">&quot;decimalLatitude&quot;</span>,</span>
<span id="cb55-4"><a href="chapter-1---the-presence-data-housekeeping.html#cb55-4" tabindex="-1"></a>                                <span class="at">species =</span> <span class="st">&quot;species&quot;</span>, <span class="at">countries =</span> <span class="st">&quot;countryCode&quot;</span>,</span>
<span id="cb55-5"><a href="chapter-1---the-presence-data-housekeeping.html#cb55-5" tabindex="-1"></a>                                <span class="at">country_refcol =</span> <span class="st">&quot;iso_a2&quot;</span>, <span class="at">tests =</span> tests)</span></code></pre></div>
<pre><code>## Testing coordinate validity</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Testing equal lat/lon</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Testing zero coordinates</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Testing country capitals</code></pre>
<pre><code>## Flagged 2 records.</code></pre>
<pre><code>## Testing country centroids</code></pre>
<pre><code>## Flagged 22 records.</code></pre>
<pre><code>## Testing GBIF headquarters, flagging records around Copenhagen</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Testing biodiversity institutions</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Flagged 24 of 1862 records, EQ = 0.01.</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb71-1" tabindex="-1"></a>vseo <span class="ot">&lt;-</span> vseo[flags_vseo<span class="sc">$</span>.summary,]</span></code></pre></div>
</div>
<div id="remove-rows-based-on-additional-gbif-information" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Remove rows based on additional GBIF information<a href="chapter-1---the-presence-data-housekeeping.html#remove-rows-based-on-additional-gbif-information" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>GBIF provides uncertainty related to the precision of the coordinate. We can use this information to further filter our dataset by removing coordinates with very high uncertainty. Out models will be made with a spatial resolution of 10km (will see in later chapters) so if the coordinate is reported to have an higher uncertainty we remove it. However, not all rows have uncertainty reported. We have to preserved those rows without information as well because we don’t know the precision.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb72-1" tabindex="-1"></a><span class="co"># Remove high coordinate uncertainty</span></span>
<span id="cb72-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb72-2" tabindex="-1"></a>u_vasp <span class="ot">&lt;-</span> vasp<span class="sc">$</span>coordinateUncertaintyInMeters</span>
<span id="cb72-3"><a href="chapter-1---the-presence-data-housekeeping.html#cb72-3" tabindex="-1"></a>vasp <span class="ot">&lt;-</span> vasp[u_vasp <span class="sc">&lt;=</span> <span class="dv">10000</span> <span class="sc">|</span> <span class="fu">is.na</span>(u_vasp),]</span>
<span id="cb72-4"><a href="chapter-1---the-presence-data-housekeeping.html#cb72-4" tabindex="-1"></a></span>
<span id="cb72-5"><a href="chapter-1---the-presence-data-housekeeping.html#cb72-5" tabindex="-1"></a>u_vlat <span class="ot">&lt;-</span> vlat<span class="sc">$</span>coordinateUncertaintyInMeters</span>
<span id="cb72-6"><a href="chapter-1---the-presence-data-housekeeping.html#cb72-6" tabindex="-1"></a>vlat <span class="ot">&lt;-</span> vlat[u_vlat <span class="sc">&lt;=</span> <span class="dv">10000</span> <span class="sc">|</span> <span class="fu">is.na</span>(u_vlat),]</span>
<span id="cb72-7"><a href="chapter-1---the-presence-data-housekeeping.html#cb72-7" tabindex="-1"></a></span>
<span id="cb72-8"><a href="chapter-1---the-presence-data-housekeeping.html#cb72-8" tabindex="-1"></a>u_vseo <span class="ot">&lt;-</span> vseo<span class="sc">$</span>coordinateUncertaintyInMeters</span>
<span id="cb72-9"><a href="chapter-1---the-presence-data-housekeeping.html#cb72-9" tabindex="-1"></a>vseo <span class="ot">&lt;-</span> vseo[u_vseo <span class="sc">&lt;=</span> <span class="dv">10000</span> <span class="sc">|</span> <span class="fu">is.na</span>(u_vseo),]</span></code></pre></div>
<p>We can also remove Fossil records if they are reported by GBIF:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb73-1" tabindex="-1"></a><span class="co"># Remove fossil records</span></span>
<span id="cb73-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb73-2" tabindex="-1"></a>vasp <span class="ot">&lt;-</span> vasp[vasp<span class="sc">$</span>basisOfRecord <span class="sc">!=</span> <span class="st">&quot;FOSSIL_SPECIMEN&quot;</span>,]</span>
<span id="cb73-3"><a href="chapter-1---the-presence-data-housekeeping.html#cb73-3" tabindex="-1"></a>vlat <span class="ot">&lt;-</span> vlat[vlat<span class="sc">$</span>basisOfRecord <span class="sc">!=</span> <span class="st">&quot;FOSSIL_SPECIMEN&quot;</span>,]</span>
<span id="cb73-4"><a href="chapter-1---the-presence-data-housekeeping.html#cb73-4" tabindex="-1"></a>vseo <span class="ot">&lt;-</span> vseo[vseo<span class="sc">$</span>basisOfRecord <span class="sc">!=</span> <span class="st">&quot;FOSSIL_SPECIMEN&quot;</span>,]</span></code></pre></div>
<p>For some records, an individual count is reported. This can be higher than one (for instace, how many times a species is seen in a camera trap) but it can also be zero, indicating absence. We only keep those that have 1 or more count or if this info is not reported.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb74-1" tabindex="-1"></a><span class="co"># Sometimes there are records of absences. Remove them.</span></span>
<span id="cb74-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb74-2" tabindex="-1"></a>i_vasp <span class="ot">&lt;-</span> vasp<span class="sc">$</span>individualCount </span>
<span id="cb74-3"><a href="chapter-1---the-presence-data-housekeeping.html#cb74-3" tabindex="-1"></a>vasp <span class="ot">&lt;-</span> vasp[i_vasp <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(i_vasp) , ]</span>
<span id="cb74-4"><a href="chapter-1---the-presence-data-housekeeping.html#cb74-4" tabindex="-1"></a></span>
<span id="cb74-5"><a href="chapter-1---the-presence-data-housekeeping.html#cb74-5" tabindex="-1"></a>i_vlat <span class="ot">&lt;-</span> vlat<span class="sc">$</span>individualCount </span>
<span id="cb74-6"><a href="chapter-1---the-presence-data-housekeeping.html#cb74-6" tabindex="-1"></a>vlat <span class="ot">&lt;-</span> vlat[i_vlat <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(i_vlat) , ]</span>
<span id="cb74-7"><a href="chapter-1---the-presence-data-housekeeping.html#cb74-7" tabindex="-1"></a></span>
<span id="cb74-8"><a href="chapter-1---the-presence-data-housekeeping.html#cb74-8" tabindex="-1"></a>i_vseo <span class="ot">&lt;-</span> vseo<span class="sc">$</span>individualCount </span>
<span id="cb74-9"><a href="chapter-1---the-presence-data-housekeeping.html#cb74-9" tabindex="-1"></a>vseo <span class="ot">&lt;-</span> vseo[i_vseo <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(i_vseo) , ]</span></code></pre></div>
<p>To preserve some quality we remove very old records that might not exist anymore or might have very imprecise location. Here we arbitrarily chose 1970 to define a date of reliable records.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb75-1" tabindex="-1"></a><span class="co"># Remove very old records</span></span>
<span id="cb75-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb75-2" tabindex="-1"></a>vasp <span class="ot">&lt;-</span> vasp[vasp<span class="sc">$</span>year <span class="sc">&gt;</span> <span class="dv">1970</span> <span class="sc">|</span> <span class="fu">is.na</span>(vasp<span class="sc">$</span>year), ]</span>
<span id="cb75-3"><a href="chapter-1---the-presence-data-housekeeping.html#cb75-3" tabindex="-1"></a>vlat <span class="ot">&lt;-</span> vlat[vlat<span class="sc">$</span>year <span class="sc">&gt;</span> <span class="dv">1970</span> <span class="sc">|</span> <span class="fu">is.na</span>(vlat<span class="sc">$</span>year), ]</span>
<span id="cb75-4"><a href="chapter-1---the-presence-data-housekeeping.html#cb75-4" tabindex="-1"></a>vseo <span class="ot">&lt;-</span> vseo[vseo<span class="sc">$</span>year <span class="sc">&gt;</span> <span class="dv">1970</span> <span class="sc">|</span> <span class="fu">is.na</span>(vseo<span class="sc">$</span>year), ]</span></code></pre></div>
</div>
<div id="remove-duplicated-coordinates" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Remove duplicated coordinates<a href="chapter-1---the-presence-data-housekeeping.html#remove-duplicated-coordinates" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Some of the records might be observed at the same location (e.g. same camera trapping site at different field work seasons). We want only one record per location, so we can filter out repeated location, keeping just one (preserving the uniques).</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb76-1" tabindex="-1"></a><span class="co"># Select only coordinates and remove duplicated coordinates</span></span>
<span id="cb76-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb76-2" tabindex="-1"></a>vasp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">species=</span><span class="st">&quot;Vaspis&quot;</span>, <span class="at">x=</span>vasp<span class="sc">$</span>decimalLongitude, <span class="at">y=</span>vasp<span class="sc">$</span>decimalLatitude)</span>
<span id="cb76-3"><a href="chapter-1---the-presence-data-housekeeping.html#cb76-3" tabindex="-1"></a>vasp <span class="ot">&lt;-</span> <span class="fu">unique</span>(vasp)</span>
<span id="cb76-4"><a href="chapter-1---the-presence-data-housekeeping.html#cb76-4" tabindex="-1"></a></span>
<span id="cb76-5"><a href="chapter-1---the-presence-data-housekeeping.html#cb76-5" tabindex="-1"></a>vlat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">species=</span><span class="st">&quot;Vlatastei&quot;</span>, <span class="at">x=</span>vlat<span class="sc">$</span>decimalLongitude, <span class="at">y=</span>vlat<span class="sc">$</span>decimalLatitude)</span>
<span id="cb76-6"><a href="chapter-1---the-presence-data-housekeeping.html#cb76-6" tabindex="-1"></a>vlat <span class="ot">&lt;-</span> <span class="fu">unique</span>(vlat)</span>
<span id="cb76-7"><a href="chapter-1---the-presence-data-housekeeping.html#cb76-7" tabindex="-1"></a></span>
<span id="cb76-8"><a href="chapter-1---the-presence-data-housekeeping.html#cb76-8" tabindex="-1"></a>vseo <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">species=</span><span class="st">&quot;Vseoanei&quot;</span>, <span class="at">x=</span>vseo<span class="sc">$</span>decimalLongitude, <span class="at">y=</span>vseo<span class="sc">$</span>decimalLatitude)</span>
<span id="cb76-9"><a href="chapter-1---the-presence-data-housekeeping.html#cb76-9" tabindex="-1"></a>vseo <span class="ot">&lt;-</span> <span class="fu">unique</span>(vseo)</span></code></pre></div>
<p>We can check the size again:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb77-1" tabindex="-1"></a><span class="fu">dim</span>(vasp)</span></code></pre></div>
<pre><code>## [1] 14323     3</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb79-1" tabindex="-1"></a><span class="fu">dim</span>(vlat)</span></code></pre></div>
<pre><code>## [1] 2193    3</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb81-1" tabindex="-1"></a><span class="fu">dim</span>(vseo)</span></code></pre></div>
<pre><code>## [1] 1356    3</code></pre>
</div>
<div id="check-map" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Check map<a href="chapter-1---the-presence-data-housekeeping.html#check-map" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can merge the three species in the same dataframe to have only one file.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb83-1" tabindex="-1"></a>species <span class="ot">&lt;-</span> <span class="fu">rbind</span>(vasp, vlat, vseo)</span></code></pre></div>
<p>and we can plot our points to check in the map if we spot some obvious errors:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb84-1" tabindex="-1"></a>sp_factor <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(species<span class="sc">$</span>species)</span>
<span id="cb84-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb84-2" tabindex="-1"></a><span class="fu">levels</span>(sp_factor)</span></code></pre></div>
<pre><code>## [1] &quot;Vaspis&quot;    &quot;Vlatastei&quot; &quot;Vseoanei&quot;</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb86-1" tabindex="-1"></a><span class="fu">levels</span>(sp_factor) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb86-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb86-2" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="fu">as.character</span>(sp_factor)</span>
<span id="cb86-3"><a href="chapter-1---the-presence-data-housekeeping.html#cb86-3" tabindex="-1"></a><span class="fu">plot</span>(species<span class="sc">$</span>x, species<span class="sc">$</span>y, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.3</span>, <span class="at">col=</span>color)</span>
<span id="cb86-4"><a href="chapter-1---the-presence-data-housekeeping.html#cb86-4" tabindex="-1"></a></span>
<span id="cb86-5"><a href="chapter-1---the-presence-data-housekeeping.html#cb86-5" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="sc">-</span><span class="fl">0.5</span>, <span class="at">col=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb86-6"><a href="chapter-1---the-presence-data-housekeeping.html#cb86-6" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">41</span>, <span class="at">col=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb86-7"><a href="chapter-1---the-presence-data-housekeeping.html#cb86-7" tabindex="-1"></a></span>
<span id="cb86-8"><a href="chapter-1---the-presence-data-housekeeping.html#cb86-8" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">5</span>, <span class="at">col=</span><span class="st">&#39;orange&#39;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb86-9"><a href="chapter-1---the-presence-data-housekeeping.html#cb86-9" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">41</span>, <span class="at">col=</span><span class="st">&#39;orange&#39;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="ENM_tutorial_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>As shown by the plot with the lines, <em>V. seoanei</em> in blue have a few suspicious points at the east of main distribution and also at the south, while <em>V. aspis</em> has some wrong points at south west of the main distribution. We can remove those points based on the coordinates:</p>
<p>For <em>V. soanei</em> everything that is at the right of -0.5º longitude OR south of 41º latitude is to remove:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb87-1" tabindex="-1"></a>mask <span class="ot">&lt;-</span> species<span class="sc">$</span>species <span class="sc">==</span> <span class="st">&quot;Vseoanei&quot;</span> <span class="sc">&amp;</span> ( species<span class="sc">$</span>x <span class="sc">&gt;</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">|</span> species<span class="sc">$</span>y <span class="sc">&lt;</span> <span class="dv">41</span>)</span>
<span id="cb87-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb87-2" tabindex="-1"></a>species <span class="ot">&lt;-</span> species[<span class="sc">!</span>mask,]</span></code></pre></div>
<p>For <em>V aspis</em> we remove everythin that is at left of 5ª longitude AND south of 41º latitude.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb88-1" tabindex="-1"></a>mask <span class="ot">&lt;-</span> species<span class="sc">$</span>species <span class="sc">==</span> <span class="st">&quot;Vaspis&quot;</span> <span class="sc">&amp;</span> ( species<span class="sc">$</span>x <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">&amp;</span> species<span class="sc">$</span>y <span class="sc">&lt;</span> <span class="dv">41</span>)</span>
<span id="cb88-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb88-2" tabindex="-1"></a>species <span class="ot">&lt;-</span> species[<span class="sc">!</span>mask,]</span></code></pre></div>
</div>
<div id="save-the-new-data" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Save the new data<a href="chapter-1---the-presence-data-housekeeping.html#save-the-new-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can check the final dimensions:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb89-1" tabindex="-1"></a><span class="fu">dim</span>(vasp)</span></code></pre></div>
<pre><code>## [1] 14323     3</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb91-1" tabindex="-1"></a><span class="fu">dim</span>(vlat)</span></code></pre></div>
<pre><code>## [1] 2193    3</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb93-1" tabindex="-1"></a><span class="fu">dim</span>(vseo)</span></code></pre></div>
<pre><code>## [1] 1356    3</code></pre>
<p>We set a file name and we write our data set:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="chapter-1---the-presence-data-housekeeping.html#cb95-1" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="st">&quot;data/species/speciesPresence_v1.csv&quot;</span></span>
<span id="cb95-2"><a href="chapter-1---the-presence-data-housekeeping.html#cb95-2" tabindex="-1"></a><span class="fu">write.table</span>(species, filename, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">row.names=</span><span class="cn">FALSE</span>, <span class="at">col.names=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>We saved as version 1 because we will have to further remove more data to match our model spatial resolution (Chapter 3).</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>In RStudio, you can monitor the Environment panel, usually located at the top right corner of the interface, for updates on the dataset dimensions.<a href="chapter-1---the-presence-data-housekeeping.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="course-folder-structure-and-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-2---processing-the-raster-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

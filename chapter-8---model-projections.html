<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Chapter 8 - Model projections | Ecological Niche Modelling</title>
  <meta name="description" content="10 Chapter 8 - Model projections | Ecological Niche Modelling" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Chapter 8 - Model projections | Ecological Niche Modelling" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Chapter 8 - Model projections | Ecological Niche Modelling" />
  
  
  

<meta name="author" content="Pedro Tarroso (FCUP / BIOPOLIS-CIBIO)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="final-considerations-for-the-ensembling.html"/>
<link rel="next" href="chapter-9---finally-answering-the-question.html"/>
<script src="assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble</a></li>
<li class="chapter" data-level="1" data-path="course-folder-structure-and-data.html"><a href="course-folder-structure-and-data.html"><i class="fa fa-check"></i><b>1</b> Course folder structure and data</a></li>
<li class="chapter" data-level="2" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html"><i class="fa fa-check"></i><b>2</b> Chapter 1 - The presence data housekeeping</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html#remove-rows-with-missing-coordinates"><i class="fa fa-check"></i><b>2.1</b> Remove rows with missing coordinates</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html#remove-rows-that-fail-cleaning-tests"><i class="fa fa-check"></i><b>2.2</b> Remove rows that fail cleaning tests</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html#remove-rows-based-on-additional-gbif-information"><i class="fa fa-check"></i><b>2.3</b> Remove rows based on additional GBIF information</a></li>
<li class="chapter" data-level="2.4" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html#remove-duplicated-coordinates"><i class="fa fa-check"></i><b>2.4</b> Remove duplicated coordinates</a></li>
<li class="chapter" data-level="2.5" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html#check-map"><i class="fa fa-check"></i><b>2.5</b> Check map</a></li>
<li class="chapter" data-level="2.6" data-path="chapter-1---the-presence-data-housekeeping.html"><a href="chapter-1---the-presence-data-housekeeping.html#save-the-new-data"><i class="fa fa-check"></i><b>2.6</b> Save the new data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-2---processing-the-raster-data.html"><a href="chapter-2---processing-the-raster-data.html"><i class="fa fa-check"></i><b>3</b> Chapter 2 - Processing the raster data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter-2---processing-the-raster-data.html"><a href="chapter-2---processing-the-raster-data.html#general-layers"><i class="fa fa-check"></i><b>3.1</b> General layers</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-2---processing-the-raster-data.html"><a href="chapter-2---processing-the-raster-data.html#processing-climate-layers"><i class="fa fa-check"></i><b>3.2</b> Processing climate layers</a></li>
<li class="chapter" data-level="3.3" data-path="chapter-2---processing-the-raster-data.html"><a href="chapter-2---processing-the-raster-data.html#process-evi"><i class="fa fa-check"></i><b>3.3</b> Process EVI</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-3---final-optimization-of-presence-data.html"><a href="chapter-3---final-optimization-of-presence-data.html"><i class="fa fa-check"></i><b>4</b> Chapter 3 - Final optimization of presence data</a></li>
<li class="chapter" data-level="5" data-path="chapter-4---variable-selection-for-modelling.html"><a href="chapter-4---variable-selection-for-modelling.html"><i class="fa fa-check"></i><b>5</b> Chapter 4 - Variable selection for modelling</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chapter-4---variable-selection-for-modelling.html"><a href="chapter-4---variable-selection-for-modelling.html#define-a-training-area-with-a-buffer"><i class="fa fa-check"></i><b>5.1</b> Define a training area with a buffer</a></li>
<li class="chapter" data-level="5.2" data-path="chapter-4---variable-selection-for-modelling.html"><a href="chapter-4---variable-selection-for-modelling.html#calculate-pairwise-correlations"><i class="fa fa-check"></i><b>5.2</b> Calculate pairwise correlations</a></li>
<li class="chapter" data-level="5.3" data-path="chapter-4---variable-selection-for-modelling.html"><a href="chapter-4---variable-selection-for-modelling.html#clustering-and-selection"><i class="fa fa-check"></i><b>5.3</b> Clustering and selection</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-5---prepare-projection-variables.html"><a href="chapter-5---prepare-projection-variables.html"><i class="fa fa-check"></i><b>6</b> Chapter 5 - Prepare projection variables</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter-5---prepare-projection-variables.html"><a href="chapter-5---prepare-projection-variables.html#prepare-current-dataset-for-projection"><i class="fa fa-check"></i><b>6.1</b> Prepare current dataset for projection</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-5---prepare-projection-variables.html"><a href="chapter-5---prepare-projection-variables.html#prepare-future-climate-projections"><i class="fa fa-check"></i><b>6.2</b> Prepare future climate projections</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-6---model-building.html"><a href="chapter-6---model-building.html"><i class="fa fa-check"></i><b>7</b> Chapter 6 - Model building</a>
<ul>
<li class="chapter" data-level="7.1" data-path="chapter-6---model-building.html"><a href="chapter-6---model-building.html#model-building"><i class="fa fa-check"></i><b>7.1</b> Model building</a></li>
<li class="chapter" data-level="7.2" data-path="chapter-6---model-building.html"><a href="chapter-6---model-building.html#repeat-for-the-other-two-species"><i class="fa fa-check"></i><b>7.2</b> Repeat for the other two species</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="chapter-6---model-building.html"><a href="chapter-6---model-building.html#vipera-latastei"><i class="fa fa-check"></i><b>7.2.1</b> <em>Vipera latastei</em></a></li>
<li class="chapter" data-level="7.2.2" data-path="chapter-6---model-building.html"><a href="chapter-6---model-building.html#vipera-seoanei"><i class="fa fa-check"></i><b>7.2.2</b> <em>Vipera seoanei</em></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chapter-6---model-building.html"><a href="chapter-6---model-building.html#final-considerations-for-the-modelling"><i class="fa fa-check"></i><b>7.3</b> Final considerations for the modelling</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-7---model-ensemble.html"><a href="chapter-7---model-ensemble.html"><i class="fa fa-check"></i><b>8</b> Chapter 7 - Model ensemble</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chapter-7---model-ensemble.html"><a href="chapter-7---model-ensemble.html#ensembling-vipera-aspis"><i class="fa fa-check"></i><b>8.1</b> Ensembling <em>Vipera aspis</em></a></li>
<li class="chapter" data-level="8.2" data-path="chapter-7---model-ensemble.html"><a href="chapter-7---model-ensemble.html#ensembling-vipera-latastei"><i class="fa fa-check"></i><b>8.2</b> Ensembling <em>Vipera latastei</em></a></li>
<li class="chapter" data-level="8.3" data-path="chapter-7---model-ensemble.html"><a href="chapter-7---model-ensemble.html#ensembling-vipera-seoanei"><i class="fa fa-check"></i><b>8.3</b> Ensembling <em>Vipera seoanei</em></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="final-considerations-for-the-ensembling.html"><a href="final-considerations-for-the-ensembling.html"><i class="fa fa-check"></i><b>9</b> Final considerations for the ensembling</a></li>
<li class="chapter" data-level="10" data-path="chapter-8---model-projections.html"><a href="chapter-8---model-projections.html"><i class="fa fa-check"></i><b>10</b> Chapter 8 - Model projections</a>
<ul>
<li class="chapter" data-level="10.1" data-path="chapter-8---model-projections.html"><a href="chapter-8---model-projections.html#projecting-vipera-aspis-models"><i class="fa fa-check"></i><b>10.1</b> Projecting <em>Vipera aspis</em> models</a></li>
<li class="chapter" data-level="10.2" data-path="chapter-8---model-projections.html"><a href="chapter-8---model-projections.html#projecting-vipera-latastei-models"><i class="fa fa-check"></i><b>10.2</b> Projecting <em>Vipera latastei</em> models</a></li>
<li class="chapter" data-level="10.3" data-path="chapter-8---model-projections.html"><a href="chapter-8---model-projections.html#projecting-vipera-latastei-models-1"><i class="fa fa-check"></i><b>10.3</b> Projecting <em>Vipera latastei</em> models</a></li>
<li class="chapter" data-level="10.4" data-path="chapter-8---model-projections.html"><a href="chapter-8---model-projections.html#final-considerations-for-projections"><i class="fa fa-check"></i><b>10.4</b> Final considerations for projections</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="chapter-9---finally-answering-the-question.html"><a href="chapter-9---finally-answering-the-question.html"><i class="fa fa-check"></i><b>11</b> Chapter 9 - Finally, answering the question</a></li>
<li class="chapter" data-level="12" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>12</b> Conclusion</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Ecological Niche Modelling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-8---model-projections" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">10</span> Chapter 8 - Model projections<a href="chapter-8---model-projections.html#chapter-8---model-projections" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter, we are going to use the ensemble models to project onto our region of interest, which is the Iberian Peninsula. Additionally, we have multiple ages and SSPs to project. By the end of this chapter, we will have projections for</p>
<ul>
<li>Current conditions</li>
<li>Period 2011-2040
<ul>
<li>SSP 126</li>
<li>SSP 585</li>
</ul></li>
<li>Period 2041-2060
<ul>
<li>SSP 126</li>
<li>SSP 485</li>
</ul></li>
<li>Period 2061-2080
<ul>
<li>SSP 126</li>
<li>SSP 586</li>
</ul></li>
</ul>
<p>This results in 7 model projections for the Iberian Peninsula.</p>
<p>We need both <em>terra</em> library for opening the varaibles, and <em>biomod2</em> for interpreting the models.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="chapter-8---model-projections.html#cb209-1" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb209-2"><a href="chapter-8---model-projections.html#cb209-2" tabindex="-1"></a><span class="fu">library</span>(biomod2)</span></code></pre></div>
<p>We can define here some variables that will be useful for looping over ages and SSPs (similar to Chapter 5) to read and project models to different time periods.”</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="chapter-8---model-projections.html#cb210-1" tabindex="-1"></a>ages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;2021-2040&quot;</span>, <span class="st">&quot;2041-2060&quot;</span>, <span class="st">&quot;2061-2080&quot;</span>)</span>
<span id="cb210-2"><a href="chapter-8---model-projections.html#cb210-2" tabindex="-1"></a>ssps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;126&quot;</span>, <span class="st">&quot;585&quot;</span>)</span></code></pre></div>
<p>Again, we will proceed with the first species and then run the same code for the other two to obtain all projections.</p>
<p>We can open the raster for the current period variables as this will be constant for all current projections.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="chapter-8---model-projections.html#cb211-1" tabindex="-1"></a>curp <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&quot;data/rasters/proj_current.tif&quot;</span>)</span></code></pre></div>
<div id="projecting-vipera-aspis-models" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Projecting <em>Vipera aspis</em> models<a href="chapter-8---model-projections.html#projecting-vipera-aspis-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>WE use the same trick as in the previous chapter to open the ensembled model available in the <em>models/Vaspis</em> folder:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="chapter-8---model-projections.html#cb212-1" tabindex="-1"></a>vaName <span class="ot">&lt;-</span> <span class="fu">load</span>(<span class="st">&quot;models/Vaspis/Vaspis.EcoMod.ensemble.models.out&quot;</span>)</span>
<span id="cb212-2"><a href="chapter-8---model-projections.html#cb212-2" tabindex="-1"></a>vaEnsbl <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">str2lang</span>(vaName))</span></code></pre></div>
<p>Until now, we have been focusing in the continuous probability predictions. However, models can be converted to binary (presence vs. absence) by setting a threshold that results in best performance. We can check which threshold <em>biomod2</em> is using for these models.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="chapter-8---model-projections.html#cb213-1" tabindex="-1"></a><span class="fu">get_evaluations</span>(vaEnsbl)</span></code></pre></div>
<pre><code>##                                              full.name merged.by.PA
## 1 Vaspis_EMmedianByTSS_mergedData_mergedRun_mergedAlgo   mergedData
## 2 Vaspis_EMmedianByTSS_mergedData_mergedRun_mergedAlgo   mergedData
## 3 Vaspis_EMmedianByROC_mergedData_mergedRun_mergedAlgo   mergedData
## 4 Vaspis_EMmedianByROC_mergedData_mergedRun_mergedAlgo   mergedData
##   merged.by.run merged.by.algo filtered.by     algo metric.eval cutoff
## 1     mergedRun     mergedAlgo         TSS EMmedian         TSS  510.0
## 2     mergedRun     mergedAlgo         TSS EMmedian         ROC  510.5
## 3     mergedRun     mergedAlgo         ROC EMmedian         TSS  510.0
## 4     mergedRun     mergedAlgo         ROC EMmedian         ROC  510.5
##   sensitivity specificity calibration validation evaluation
## 1      69.793      69.125       0.391         NA         NA
## 2      69.551      69.519       0.738         NA         NA
## 3      69.793      69.125       0.391         NA         NA
## 4      69.551      69.519       0.738         NA         NA</code></pre>
<p>Depending on the metric, the threshold varies as it has to maximize the performance of each metric separately. For TSS, the threshold (cutoff) is set to 0.474, and for ROC, it is set to 0.468. Note that <em>biomod2</em> multiplies the probabilities by 1000, so they range between 0 and 1000.</p>
<p>We can project the model to current conditions in the Iberian Peninsula. The function will create both continuous predictions and binary predictions using the thresholds mentioned above. It is important to name the projections appropriately for easy identification of the rasters. We set the <code>proj.name</code> to <strong>Current</strong> and a new folder named <em>proj_Current</em> will be created inside <em>models/Vaspis</em>. In this folder, two rasters will be saved for continuous and binary predictions. Also, the argument <em>new.env</em> refers to the new environmental conditions that are the raster variables we want to project to.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="chapter-8---model-projections.html#cb215-1" tabindex="-1"></a>vaProj <span class="ot">&lt;-</span> <span class="fu">BIOMOD_EnsembleForecasting</span>(<span class="at">bm.em =</span> vaEnsbl,</span>
<span id="cb215-2"><a href="chapter-8---model-projections.html#cb215-2" tabindex="-1"></a>                                     <span class="at">proj.name =</span> <span class="st">&#39;Current&#39;</span>,</span>
<span id="cb215-3"><a href="chapter-8---model-projections.html#cb215-3" tabindex="-1"></a>                                     <span class="at">new.env =</span> curp,</span>
<span id="cb215-4"><a href="chapter-8---model-projections.html#cb215-4" tabindex="-1"></a>                                     <span class="at">models.chosen =</span> <span class="st">&#39;all&#39;</span>,</span>
<span id="cb215-5"><a href="chapter-8---model-projections.html#cb215-5" tabindex="-1"></a>                                     <span class="at">metric.binary =</span> <span class="st">&#39;TSS&#39;</span>)</span></code></pre></div>
<p>We will have to do the same for each combination of age and SSP projections. For that, we use a nested for loop as before (chapter 5). The logic is as follows:</p>
<ul>
<li>For each combination of age and ssp
<ol style="list-style-type: decimal">
<li>Construct the respective filename using age and SSP and open the raster.</li>
<li>Project the ensembled model to the respective time period, correctly naming the projection with <code>age_ssp</code>.</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="chapter-8---model-projections.html#cb216-1" tabindex="-1"></a><span class="cf">for</span> (age <span class="cf">in</span> ages) {</span>
<span id="cb216-2"><a href="chapter-8---model-projections.html#cb216-2" tabindex="-1"></a>    <span class="cf">for</span> (ssp <span class="cf">in</span> ssps) {</span>
<span id="cb216-3"><a href="chapter-8---model-projections.html#cb216-3" tabindex="-1"></a>        projVars <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(<span class="st">&quot;data/rasters/proj_&quot;</span>, age, <span class="st">&quot;_&quot;</span>, ssp, <span class="st">&quot;.tif&quot;</span>))</span>
<span id="cb216-4"><a href="chapter-8---model-projections.html#cb216-4" tabindex="-1"></a>        vaProj <span class="ot">&lt;-</span> <span class="fu">BIOMOD_EnsembleForecasting</span>(<span class="at">bm.em =</span> vaEnsbl,</span>
<span id="cb216-5"><a href="chapter-8---model-projections.html#cb216-5" tabindex="-1"></a>                                             <span class="at">proj.name =</span> <span class="fu">paste0</span>(age, <span class="st">&quot;_&quot;</span>, ssp),</span>
<span id="cb216-6"><a href="chapter-8---model-projections.html#cb216-6" tabindex="-1"></a>                                             <span class="at">new.env =</span> projVars,</span>
<span id="cb216-7"><a href="chapter-8---model-projections.html#cb216-7" tabindex="-1"></a>                                             <span class="at">models.chosen =</span> <span class="st">&#39;all&#39;</span>,</span>
<span id="cb216-8"><a href="chapter-8---model-projections.html#cb216-8" tabindex="-1"></a>                                             <span class="at">metric.binary =</span> <span class="st">&#39;TSS&#39;</span>)</span>
<span id="cb216-9"><a href="chapter-8---model-projections.html#cb216-9" tabindex="-1"></a>    }</span>
<span id="cb216-10"><a href="chapter-8---model-projections.html#cb216-10" tabindex="-1"></a>}</span></code></pre></div>
<p>At this stage, we should have a folder inside <em>models/Vaspis</em> for each projection that we built. We now need to run the code for the other two species to complete all projections.</p>
</div>
<div id="projecting-vipera-latastei-models" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Projecting <em>Vipera latastei</em> models<a href="chapter-8---model-projections.html#projecting-vipera-latastei-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We load the <em>Vipera latastei</em> ensembled model and run the code.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="chapter-8---model-projections.html#cb217-1" tabindex="-1"></a>vlName <span class="ot">&lt;-</span> <span class="fu">load</span>(<span class="st">&quot;models/Vlatastei/Vlatastei.EcoMod.ensemble.models.out&quot;</span>)</span>
<span id="cb217-2"><a href="chapter-8---model-projections.html#cb217-2" tabindex="-1"></a>vlEnsbl <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">str2lang</span>(vlName))</span>
<span id="cb217-3"><a href="chapter-8---model-projections.html#cb217-3" tabindex="-1"></a></span>
<span id="cb217-4"><a href="chapter-8---model-projections.html#cb217-4" tabindex="-1"></a><span class="fu">get_evaluations</span>(vlEnsbl)</span>
<span id="cb217-5"><a href="chapter-8---model-projections.html#cb217-5" tabindex="-1"></a></span>
<span id="cb217-6"><a href="chapter-8---model-projections.html#cb217-6" tabindex="-1"></a><span class="co"># Project to current time</span></span>
<span id="cb217-7"><a href="chapter-8---model-projections.html#cb217-7" tabindex="-1"></a>vlProj <span class="ot">&lt;-</span> <span class="fu">BIOMOD_EnsembleForecasting</span>(<span class="at">bm.em =</span> vlEnsbl,</span>
<span id="cb217-8"><a href="chapter-8---model-projections.html#cb217-8" tabindex="-1"></a>                                     <span class="at">proj.name =</span> <span class="st">&#39;Current&#39;</span>,</span>
<span id="cb217-9"><a href="chapter-8---model-projections.html#cb217-9" tabindex="-1"></a>                                     <span class="at">new.env =</span> curp,</span>
<span id="cb217-10"><a href="chapter-8---model-projections.html#cb217-10" tabindex="-1"></a>                                     <span class="at">models.chosen =</span> <span class="st">&#39;all&#39;</span>,</span>
<span id="cb217-11"><a href="chapter-8---model-projections.html#cb217-11" tabindex="-1"></a>                                     <span class="at">metric.binary =</span> <span class="st">&#39;TSS&#39;</span>)</span>
<span id="cb217-12"><a href="chapter-8---model-projections.html#cb217-12" tabindex="-1"></a><span class="co"># Project to future periods</span></span>
<span id="cb217-13"><a href="chapter-8---model-projections.html#cb217-13" tabindex="-1"></a><span class="cf">for</span> (age <span class="cf">in</span> ages) {</span>
<span id="cb217-14"><a href="chapter-8---model-projections.html#cb217-14" tabindex="-1"></a>    <span class="cf">for</span> (ssp <span class="cf">in</span> ssps) {</span>
<span id="cb217-15"><a href="chapter-8---model-projections.html#cb217-15" tabindex="-1"></a>        projVars <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(<span class="st">&quot;data/rasters/proj_&quot;</span>, age, <span class="st">&quot;_&quot;</span>, ssp, <span class="st">&quot;.tif&quot;</span>))</span>
<span id="cb217-16"><a href="chapter-8---model-projections.html#cb217-16" tabindex="-1"></a>        vlProj <span class="ot">&lt;-</span> <span class="fu">BIOMOD_EnsembleForecasting</span>(<span class="at">bm.em =</span> vlEnsbl,</span>
<span id="cb217-17"><a href="chapter-8---model-projections.html#cb217-17" tabindex="-1"></a>                                             <span class="at">proj.name =</span> <span class="fu">paste0</span>(age, <span class="st">&quot;_&quot;</span>, ssp),</span>
<span id="cb217-18"><a href="chapter-8---model-projections.html#cb217-18" tabindex="-1"></a>                                             <span class="at">new.env =</span> projVars,</span>
<span id="cb217-19"><a href="chapter-8---model-projections.html#cb217-19" tabindex="-1"></a>                                             <span class="at">models.chosen =</span> <span class="st">&#39;all&#39;</span>,</span>
<span id="cb217-20"><a href="chapter-8---model-projections.html#cb217-20" tabindex="-1"></a>                                             <span class="at">metric.binary =</span> <span class="st">&#39;TSS&#39;</span>)</span>
<span id="cb217-21"><a href="chapter-8---model-projections.html#cb217-21" tabindex="-1"></a>    }</span>
<span id="cb217-22"><a href="chapter-8---model-projections.html#cb217-22" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="projecting-vipera-latastei-models-1" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Projecting <em>Vipera latastei</em> models<a href="chapter-8---model-projections.html#projecting-vipera-latastei-models-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Nowe for <em>Vipera seoanei</em>.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="chapter-8---model-projections.html#cb218-1" tabindex="-1"></a>vsName <span class="ot">&lt;-</span> <span class="fu">load</span>(<span class="st">&quot;models/Vseoanei/Vseoanei.EcoMod.ensemble.models.out&quot;</span>)</span>
<span id="cb218-2"><a href="chapter-8---model-projections.html#cb218-2" tabindex="-1"></a>vsEnsbl <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">str2lang</span>(vsName))</span>
<span id="cb218-3"><a href="chapter-8---model-projections.html#cb218-3" tabindex="-1"></a></span>
<span id="cb218-4"><a href="chapter-8---model-projections.html#cb218-4" tabindex="-1"></a><span class="fu">get_evaluations</span>(vsEnsbl)</span>
<span id="cb218-5"><a href="chapter-8---model-projections.html#cb218-5" tabindex="-1"></a></span>
<span id="cb218-6"><a href="chapter-8---model-projections.html#cb218-6" tabindex="-1"></a><span class="co"># Project to current time</span></span>
<span id="cb218-7"><a href="chapter-8---model-projections.html#cb218-7" tabindex="-1"></a>vsProj <span class="ot">&lt;-</span> <span class="fu">BIOMOD_EnsembleForecasting</span>(<span class="at">bm.em =</span> vsEnsbl,</span>
<span id="cb218-8"><a href="chapter-8---model-projections.html#cb218-8" tabindex="-1"></a>                                     <span class="at">proj.name =</span> <span class="st">&#39;Current&#39;</span>,</span>
<span id="cb218-9"><a href="chapter-8---model-projections.html#cb218-9" tabindex="-1"></a>                                     <span class="at">new.env =</span> curp,</span>
<span id="cb218-10"><a href="chapter-8---model-projections.html#cb218-10" tabindex="-1"></a>                                     <span class="at">models.chosen =</span> <span class="st">&#39;all&#39;</span>,</span>
<span id="cb218-11"><a href="chapter-8---model-projections.html#cb218-11" tabindex="-1"></a>                                     <span class="at">metric.binary =</span> <span class="st">&#39;TSS&#39;</span>)</span>
<span id="cb218-12"><a href="chapter-8---model-projections.html#cb218-12" tabindex="-1"></a><span class="co"># Project for future</span></span>
<span id="cb218-13"><a href="chapter-8---model-projections.html#cb218-13" tabindex="-1"></a><span class="cf">for</span> (age <span class="cf">in</span> ages) {</span>
<span id="cb218-14"><a href="chapter-8---model-projections.html#cb218-14" tabindex="-1"></a>    <span class="cf">for</span> (ssp <span class="cf">in</span> ssps) {</span>
<span id="cb218-15"><a href="chapter-8---model-projections.html#cb218-15" tabindex="-1"></a>        projVars <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">paste0</span>(<span class="st">&quot;data/rasters/proj_&quot;</span>, age, <span class="st">&quot;_&quot;</span>, ssp, <span class="st">&quot;.tif&quot;</span>))</span>
<span id="cb218-16"><a href="chapter-8---model-projections.html#cb218-16" tabindex="-1"></a>        vsProj <span class="ot">&lt;-</span> <span class="fu">BIOMOD_EnsembleForecasting</span>(<span class="at">bm.em =</span> vsEnsbl,</span>
<span id="cb218-17"><a href="chapter-8---model-projections.html#cb218-17" tabindex="-1"></a>                                             <span class="at">proj.name =</span> <span class="fu">paste0</span>(age, <span class="st">&quot;_&quot;</span>, ssp),</span>
<span id="cb218-18"><a href="chapter-8---model-projections.html#cb218-18" tabindex="-1"></a>                                             <span class="at">new.env =</span> projVars,</span>
<span id="cb218-19"><a href="chapter-8---model-projections.html#cb218-19" tabindex="-1"></a>                                             <span class="at">models.chosen =</span> <span class="st">&#39;all&#39;</span>,</span>
<span id="cb218-20"><a href="chapter-8---model-projections.html#cb218-20" tabindex="-1"></a>                                             <span class="at">metric.binary =</span> <span class="st">&#39;TSS&#39;</span>)</span>
<span id="cb218-21"><a href="chapter-8---model-projections.html#cb218-21" tabindex="-1"></a>    }</span>
<span id="cb218-22"><a href="chapter-8---model-projections.html#cb218-22" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="final-considerations-for-projections" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Final considerations for projections<a href="chapter-8---model-projections.html#final-considerations-for-projections" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>At this point, we have all the projections needed to answer our initial question. By defining a smaller projection zone (the Iberian Peninsula) relevant to our research question, we have optimized both computer storage and processing time, as we avoid unnecessary projections over a larger area.</p>
<p>All files are saved in respective folders and we can access them using any GIS. As an example, here are the model projections for <em>Vipera aspis</em> for the current and future periods, only for scenario ssp 585.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="chapter-8---model-projections.html#cb219-1" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&quot;models/Vaspis/proj_Current/proj_Current_Vaspis_ensemble.tif&quot;</span>)</span>
<span id="cb219-2"><a href="chapter-8---model-projections.html#cb219-2" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&quot;models/Vaspis/proj_2021-2040_585/proj_2021-2040_585_Vaspis_ensemble.tif&quot;</span>)</span>
<span id="cb219-3"><a href="chapter-8---model-projections.html#cb219-3" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&quot;models/Vaspis/proj_2041-2060_585/proj_2041-2060_585_Vaspis_ensemble.tif&quot;</span>)</span>
<span id="cb219-4"><a href="chapter-8---model-projections.html#cb219-4" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&quot;models/Vaspis/proj_2061-2080_585/proj_2061-2080_585_Vaspis_ensemble.tif&quot;</span>)</span>
<span id="cb219-5"><a href="chapter-8---model-projections.html#cb219-5" tabindex="-1"></a></span>
<span id="cb219-6"><a href="chapter-8---model-projections.html#cb219-6" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">1</span>))</span>
<span id="cb219-7"><a href="chapter-8---model-projections.html#cb219-7" tabindex="-1"></a><span class="fu">plot</span>(p1[[<span class="dv">1</span>]], <span class="at">main=</span><span class="st">&quot;Present&quot;</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>))</span>
<span id="cb219-8"><a href="chapter-8---model-projections.html#cb219-8" tabindex="-1"></a><span class="fu">plot</span>(p2[[<span class="dv">1</span>]], <span class="at">main=</span><span class="st">&quot;2021-2040&quot;</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>))</span>
<span id="cb219-9"><a href="chapter-8---model-projections.html#cb219-9" tabindex="-1"></a><span class="fu">plot</span>(p3[[<span class="dv">1</span>]], <span class="at">main=</span><span class="st">&quot;2041-2060&quot;</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>))</span>
<span id="cb219-10"><a href="chapter-8---model-projections.html#cb219-10" tabindex="-1"></a><span class="fu">plot</span>(p4[[<span class="dv">1</span>]], <span class="at">main=</span><span class="st">&quot;2061-2080&quot;</span>, <span class="at">range=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>))</span></code></pre></div>
<p><img src="ENM_tutorial_files/figure-html/unnamed-chunk-106-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="final-considerations-for-the-ensembling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-9---finally-answering-the-question.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
